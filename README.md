# oiflib

![Checks](https://github.com/Defra-Data-Science-Centre-of-Excellence/oiflib/workflows/Format%2C%20Lint%2C%20and%20Test/badge.svg)
[![Documentation Status](https://readthedocs.org/projects/oiflib/badge/?version=latest)](https://oiflib.readthedocs.io/en/latest/?badge=latest)

A public repository for [25 Year Environment Plan Outcome Indicator Framework (OIF)](https://www.gov.uk/government/publications/25-year-environment-plan-progress-reports) related python libraries.

## Tools and practices

This project implements many of the tools and best practices recommended in [Hypermodern Python](https://cjolowicz.github.io/posts/hypermodern-python-01-setup/), it uses:

- [pyenv](https://github.com/pyenv/pyenv) for Python version management
- [poetry](https://python-poetry.org/) for packaging, dependency, and virtual environment management
- A [src package layout](https://hynek.me/articles/testing-packaging/)
- [pytest](https://docs.pytest.org/en/latest/) for unit testing
    - With [chispa](https://github.com/MrPowers/chispa) for asserting [pyspark](https://spark.apache.org/docs/latest/api/python/index.html) equality
    - And [coverage](https://coverage.readthedocs.io/) to measure test coverage
- [black](https://github.com/psf/black) for formatting
- [isort](https://timothycrosley.github.io/isort/) to order imports based on the [Google styleguide](https://google.github.io/styleguide/pyguide.html?showone=Imports_formatting#313-imports-formatting)
- [type hints](https://www.python.org/dev/peps/pep-0484/) and [mypy](http://mypy-lang.org/) for static type checking
- [Google style](https://google.github.io/styleguide/pyguide.html#38-comments-and-docstrings) [Docstrings](https://www.python.org/dev/peps/pep-0257/#what-is-a-docstring)
- [sphinx](http://www.sphinx-doc.org/) to generate documentation, with the following extentsions:
    - [autodoc](https://www.sphinx-doc.org/en/master/usage/extensions/autodoc.html) to automatically generate documentation from docstrings
    - [napoleon](https://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html) to convert google-style docstrings to reStructuredText
- [readthedocs](https://readthedocs.org/) to host the documentation generated by sphinx (NOT CURRENTLY WORKING!)
- [flake8](https://flake8.pycqa.org/en/latest/) for linting, with the following plugins:
    - [flake8-black](https://github.com/peterjc/flake8-black) to ensure alignment between linting and formatting tools
    - [flake8-isort](https://github.com/gforcada/flake8-isort) to ensure alignment between linting and import ordering tools
    - [flake8-bugbear](https://github.com/PyCQA/flake8-bugbear) to highlight various bugs and design issues not captured by other linters
    - [flake8-bandit](https://github.com/tylerwince/flake8-bandit) to identify security issues
    - [flake8-annotation](https://github.com/python-discord/flake8-annotations) to check for missing type hints
    - [flake8-docstrings](https://gitlab.com/pycqa/flake8-docstrings) to check docstring style compliance
    - [darglint](https://github.com/terrencepreilly/darglint) to check that docstring descriptions match function definitions
- [GitHub Actions](https://github.com/features/actions) for continuous integration

However, it doesn't currently use:

- [Nox](https://nox.thea.codes/) for test automation
- [mocks](https://towardsdatascience.com/stop-mocking-me-unit-tests-in-pyspark-using-pythons-mock-library-a4b5cd019d7e), [fakes, stubs](https://blog.pragmatists.com/test-doubles-fakes-mocks-and-stubs-1a7491dfa3da), or [markers](https://docs.pytest.org/en/latest/example/markers.html) in testing
- [pre-commit](https://pre-commit.com/) to leverage linters written in other languages
- [Saftey](https://github.com/pyupio/safety) to identify security vulnerabilities
- [pytype](https://google.github.io/pytype/) for static type checking
- [typeguard](https://github.com/agronholm/typeguard) for runtime type checking
- [Desert](https://desert.readthedocs.io/) or [Marshmallow](https://marshmallow.readthedocs.io/) for data validation
- [xdoctest](https://github.com/Erotemic/xdoctest) to test docstring examples
- [sphinx-autodoc-typehints](https://github.com/agronholm/sphinx-autodoc-typehints) to include type hints in documentation
- [codecov](https://codecov.io/) to report testing coverage
- [pypi](https://pypi.org/) for package hosting or [testpypi](https://test.pypi.org/) to test package hosting
- [release-drafter](https://github.com/release-drafter/release-drafter) to help draft release notes
- [Semantic Versioning](https://semver.org/) to indicate breaking changes, minor changes, or bug fixes

It also uses the following additional tools:

- [interrogate](https://interrogate.readthedocs.io/en/latest/) to check for missing docstrings
- [pandera](https://pandera.readthedocs.io/en/stable/) for data validation

---

## Structure

```
src
|
|---oiflib
|   |
|   |---<theme>
|   |   |
|   |   |---<indicator>
|   |   |   |   <activity>.py
|   |   |   |   <activity>.py
|   |   |   |   ...
|   |   |
|   |   |---<indicator>
|   |   |   |   ...
|   |   |
|   |   |   ...
|   |
|   |---<theme>
|   |   |   ...
|   |
|   |   ...
```

The `oiflib` package is divided into theme modules. These theme modules are divided into indicator modules. These indicator modules are divided into activity modules.

There are five activity modules under each indicator:

1. `extract` contains functions for reading in the input data
1. `transform` contains functions for transforming the input data into a tidy format
1. `enrich` contains functions for adding additions columns
1. `schemas` contains schemas for dataframes produced by the extract, transform, and enrich functions
1. `validate` contains functions to validate the dataframes produced by the extract, transform, and enrich functions against those schema

---

## Documentation

---

[Latest](https://oiflib.readthedocs.io/en/latest/)

## Features

---

## Installation

---

## Contribute

---

## Support

---

## License

---
